<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KEV Vulnerabilities Table</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    table { border-collapse: collapse; width: 100%; margin-top: 1em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; }
    th { background: #f0f0f0; }
    .pagination { margin: 1em 0; }
    .pagination button { margin: 0 2px; }
    #search { width: 300px; padding: 0.5em; }
  </style>
</head>
<body>
  <h1>KEV Vulnerabilities</h1>
  <input type="text" id="search" placeholder="Search..." />
  <div id="table-container"></div>
  <div class="pagination" id="pagination"></div>

  <script>
    let data = [];
    let filtered = [];
    let page = 1;
    const pageSize = 20;

    // Load JSON data
    fetch('kev.json')
      .then(res => res.json())
      .then(json => {
        // If the JSON is an object with a "vulnerabilities" array:
        data = json.vulnerabilities || json;
        filtered = data;
        renderTable();
        renderPagination();
      });

    // Search functionality
    document.getElementById('search').addEventListener('input', function() {
      const q = this.value.toLowerCase();
      filtered = data.filter(row =>
        (row.cveID || '').toLowerCase().includes(q) ||
        (row.vendorProject || '').toLowerCase().includes(q) ||
        (row.product || '').toLowerCase().includes(q) ||
        (row.vulnerabilityName || '').toLowerCase().includes(q) ||
        (row.dateAdded || '').toLowerCase().includes(q)
      );
      page = 1;
      renderTable();
      renderPagination();
    });

    function renderTable() {
      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      const rows = filtered.slice(start, end);
      let html = `<table>
        <thead>
          <tr>
            <th>cveID</th>
            <th>vendorProject</th>
            <th>product</th>
            <th>vulnerabilityName</th>
            <th>dateAdded</th>
          </tr>
        </thead>
        <tbody>
      `;
      for (const row of rows) {
        html += `<tr>
          <td>${row.cveID || ''}</td>
          <td>${row.vendorProject || ''}</td>
          <td>${row.product || ''}</td>
          <td>${row.vulnerabilityName || ''}</td>
          <td>${row.dateAdded || ''}</td>
        </tr>`;
      }
      html += '</tbody></table>';
      document.getElementById('table-container').innerHTML = html;
    }

    function renderPagination() {
      const totalPages = Math.ceil(filtered.length / pageSize);
      let html = '';
      for (let i = 1; i <= totalPages; i++) {
        html += `<button onclick="page=${i};renderTable();renderPagination();" ${i === page ? 'disabled' : ''}>${i}</button>`;
      }
      document.getElementById('pagination').innerHTML = html;
    }

    // Expose page variable for inline onclick
    window.page = page;
    window.renderTable = renderTable;
    window.renderPagination = renderPagination;
  </script>
</body>
</html>
